# Сравнение производительности REST и gRPC

Автоматизированное нагрузочное тестирование приложений глоссария с использованием Locust

## Запуск

### Подготовка окружения

Клонируйте репозиторий на свой компьютер и перейдите в папку проекта

```bash
git clone https://github.com/NickSatsuro/pyweb5-locust
```

Создание виртуального окружения

```bash
python3 -m venv venv
```

Активация для Linux/macOS:

```bash
source venv/bin/activate
```

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск тестирования

Примечание: рекомендуется заменить адрес клиента в `main.py` на адрес тестировочного стенда (строки 47 и 66)

Пример команды запуска теста для клиента gRPC
```bash
locust -f main.py --headless -u 100 -r 5 -t 3m --html report_grpc_stability.html GlossaryGrpcUser
```

Пример команды запуска теста для клиента REST
```bash
locust -f main.py --headless -u 100 -r 5 -t 3m --host http://000.000.000.000:0000 --html report_rest_stress.html GlossaryRestUser
```

Регулируемые параметры:
* `u` - количество пользователей 
* `r` - spawn rate
* `t` - время теста

## Описание тестируемых приложений

### REST API (FastAPI)

Эндпоинты:

| Метод  | Путь                     | Описание                                   |
|---------|--------------------------|--------------------------------------------|
| GET     | /api/terms               | Получение списка всех терминов             |
| GET     | /api/terms/{term_id}     | Получение термина по идентификатору        |
| GET     | /api/graph               | Получение графа терминов                   |
| POST    | /api/terms               | Создание нового термина                    |
| PUT     | /api/terms/{term_id}     | Полное обновление существующего термина    |
| DELETE  | /api/terms/{term_id}     | Удаление термина по идентификатору         |

### gRPC API

Эндпоинты:

| Метод  | Путь                     | Описание                                   |
|---------|--------------------------|--------------------------------------------|
| GET     | /api/terms               | Получение списка всех терминов             |
| GET     | /api/terms/{term_id}     | Получение термина по идентификатору        |

Сравнение проводится для 2-х эндпоинтов. Эндпоинты отличаются между собой трудоемкостью

### Распределение запросов 

* GET  /api/terms   (33,3%)
* GET  /api/terms/{term_id}    (66,7%)

### Архитектура 

* REST: FastAPI + Uvicorn 
* gRPC: grpcio + Python 
* Тестирование: Locust (headless mode)

## Тестовые сценарии

Проводится 4 тестовых сценария для каждого сервиса

### Сценарий 1: Sanity Check

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 1                           |
| Spawn rate      | 1 пользователь/сек           |
| Длительность    | 20 сек                       |
| Цель            | Проверка работоспособности   |

Гипотеза: Оба сервиса должны обрабатывать запросы без ошибок при минимальной нагрузке

### Сценарий 2: Normal Load

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 100                           |
| Spawn rate      | 7 пользователь/сек           |
| Длительность    | 60 сек                       |
| Цель            | Базовые метрики производительности   |

Гипотеза: gRPC покажет меньшую латентность из-за бинарной сериализации и HTTP/2

### Сценарий 3: Stress Test

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 300                           |
| Spawn rate      | 15 пользователь/сек           |
| Длительность    | 60 сек                       |
| Цель            | Определение пределов производительности   |

Гипотеза: При высокой нагрузке различия между REST и gRPC станут более заметными

### Сценарий 4: Stability Test

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 100                           |
| Spawn rate      | 7 пользователей/сек           |
| Длительность    | 180 сек                       |
| Цель            | Проверка стабильности под длительной нагрузкой   |

Гипотеза: Оба сервиса должны поддерживать стабильную производительность без деградации.

## Результаты тестирования 

Полученные в ходе тестирования результаты, а также характеристики тестовой среды представлены в REPORT.md

## Исследование: REST vs RPC vs GraphQL

### 1. "Performance evaluation of RESTful web services and gRPC"

Научные статьи по сравнению производительности веб-сервисов.
Основные выводы статьи: 

* gRPC показывает на 30-50% меньшую латентность по сравнению с REST при передаче структурированных данных
* Protocol Buffers обеспечивают размер сообщений в 3-10 раз меньше JSON
* HTTP/2 в gRPC позволяет эффективнее использовать соединения через мультиплексирование

### 2. "Microservices: A Performance Tester's Dream or Nightmare?"

Метрики данного исследования: 

| Протокол         | Avg Latency | Throughput        | Message Size         |
|------------------|------------|-------------------|----------------------|
| REST / JSON      | 15–50 ms   | 1000–5000 RPS     | 100% (baseline)      |
| gRPC / Protobuf  | 5–20 ms    | 3000–15000 RPS    | 30–50%               |
| GraphQL          | 20–60 ms   | 800–4000 RPS      | 80–120%              |

### 3.  "Comparing API Architectural Styles"

**REST**

* Простота реализации и отладки
* Широкая поддержка инструментов
* Читаемый формат данных (JSON)
* Хорошо подходит для публичных API

**gRPC**

* Строгая типизация через proto-файлы
* Автогенерация клиентского кода
* Поддержка streaming
* Оптимален для микросервисов

**GraphQL**

* Гибкие запросы (клиент запрашивает только нужные поля)
* Единая точка входа
* Решает проблему over-fetching/under-fetching
* Сложнее в кэшировании

### 4. "A Comparative Analysis of REST, GraphQL, and gRPC"

| Сценарий              | Рекомендация        | Причина выбора                 |
|-----------------------|---------------------|----------------------------------|
| Публичный API         | REST                | Простота интеграции             |
| Микросервисы          | gRPC                | Высокая производительность      |
| Мобильные приложения  | GraphQL             | Гибкость формирования запросов  |
| Real-time данные      | gRPC Streaming      | Поддержка двунаправленного потока |
| Высокая нагрузка      | gRPC                | Низкая латентность              |

### 6. Benchmark от Uber

Uber сравнивал JSON/HTTP и Protobuf/gRPC

* gRPC быстрее в 2-3 раза при high-throughput сценариях
* Размер payload меньше в 5-10 раз
* CPU overhead ниже из-за бинарной сериализации

## Сводная таблица характеристик

| Характеристика     | REST              | gRPC                     | GraphQL                    |
|--------------------|-------------------|--------------------------|-----------------------------|
| Протокол           | HTTP/1.1          | HTTP/2                   | HTTP/1.1 или HTTP/2         |
| Формат данных      | JSON / XML        | Protocol Buffers         | JSON                        |
| Типизация          | Слабая            | Строгая                  | Строгая (схема)             |
| Streaming          | Ограниченный      | Полный                   | Subscriptions               |
| Browser support    | Нативный          | Требует gRPC-Web         | Нативный                    |
| Caching            | Простой           | Сложный                  | Сложный                     |
| Tooling            | Отличный          | Хороший                  | Хороший                     |
| Learning curve     | Низкий            | Средний                  | Средний                     |

## Рекомендации по выбору

**REST**

* Если нужен публичный API
* Важна простота интеграции
* Работаете с браузерными клиентами
* Команда не имеет опыта с другими протоколами

**gRPC**

* Если строите микросервисную архитектуру
* Критична производительность
* Нужен streaming
* Важна строгая типизация

**GraphQL**

* Если клиенты имеют разные требования к данным
* Нужна гибкость в запросах
* Работаете с mobile-first приложениями
