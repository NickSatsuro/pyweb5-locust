# Сравнение производительности REST и gRPC

Автоматизированное нагрузочное тестирование приложений глоссария с использованием Locust

## Запуск

### Подготовка окружения

Клонируйте репозиторий на свой компьютер и перейдите в папку проекта

```bash
git clone https://github.com/NickSatsuro/pyweb5-locust
```

Создание виртуального окружения

```bash
python3 -m venv venv
```

Активация для Linux/macOS:

```bash
source venv/bin/activate
```

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск тестирования

Примечание: рекомендуется заменить адрес клиента в `main.py` на адрес тестировочного стенда (строки 47 и 66)

Пример команды запуска теста для клиента gRPC
```bash
locust -f main.py --headless -u 100 -r 5 -t 3m --html report_grpc_stability.html GlossaryGrpcUser
```

Пример команды запуска теста для клиента REST
```bash
locust -f main.py --headless -u 100 -r 5 -t 3m --host http://000.000.000.000:0000 --html report_rest_stress.html GlossaryRestUser
```

Регулируемые параметры:
* `u` - количество пользователей 
* `r` - spawn rate
* `t` - время теста

## Описание тестируемых приложений

### REST API (FastAPI)

Эндпоинты:

| Метод  | Путь                     | Описание                                   |
|---------|--------------------------|--------------------------------------------|
| GET     | /api/terms               | Получение списка всех терминов             |
| GET     | /api/terms/{term_id}     | Получение термина по идентификатору        |
| GET     | /api/graph               | Получение графа терминов                   |
| POST    | /api/terms               | Создание нового термина                    |
| PUT     | /api/terms/{term_id}     | Полное обновление существующего термина    |
| DELETE  | /api/terms/{term_id}     | Удаление термина по идентификатору         |

### gRPC API

Эндпоинты:

| Метод  | Путь                     | Описание                                   |
|---------|--------------------------|--------------------------------------------|
| GET     | /api/terms               | Получение списка всех терминов             |
| GET     | /api/terms/{term_id}     | Получение термина по идентификатору        |

Сравнение проводится для 2-х эндпоинтов. Эндпоинты отличаются между собой трудоемкостью

### Распределение запросов 

* GET  /api/terms   (33,3%)
* GET  /api/terms/{term_id}    (66,7%)

### Архитектура 

* REST: FastAPI + Uvicorn 
* gRPC: grpcio + Python 
* Тестирование: Locust (headless mode)

## Тестовые сценарии

Проводится 4 тестовых сценария для каждого сервиса

### Сценарий 1: Sanity Check

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 1                           |
| Spawn rate      | 1 пользователь/сек           |
| Длительность    | 20 сек                       |
| Цель            | Проверка работоспособности   |

Гипотеза: Оба сервиса должны обрабатывать запросы без ошибок при минимальной нагрузке

### Сценарий 2: Normal Load

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 100                           |
| Spawn rate      | 7 пользователь/сек           |
| Длительность    | 60 сек                       |
| Цель            | Базовые метрики производительности   |

Гипотеза: gRPC покажет меньшую латентность из-за бинарной сериализации и HTTP/2

### Сценарий 3: Stress Test

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 300                           |
| Spawn rate      | 15 пользователь/сек           |
| Длительность    | 60 сек                       |
| Цель            | Определение пределов производительности   |

Гипотеза: При высокой нагрузке различия между REST и gRPC станут более заметными

### Сценарий 4: Stability Test

| Параметр        | Значение                     |
|-----------------|------------------------------|
| Пользователей   | 100                           |
| Spawn rate      | 7 пользователей/сек           |
| Длительность    | 180 сек                       |
| Цель            | Проверка стабильности под длительной нагрузкой   |

Гипотеза: Оба сервиса должны поддерживать стабильную производительность без деградации.

## Результаты тестирования 

Полученные в ходе тестирования результаты, а также характеристики тестовой среды представлены в REPORT.md
