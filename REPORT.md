# Сравнение производительности REST и gRPC

## Тестовая среда 

* Процессор - Intel Cascade Lake (Intel Xeon Gen2)
* Виртуальные CPU - 1 шт
* ОС - Linux (Ubuntu)
* RAM - 1024 Mb
* Диск - 10 Gb SSD
* Зона доступности - Москва

## Сценарий sanity 

### Sanity - REST

| Метрика                   | Значение  |
| ------------------------- | --------- |
| Общее количество запросов | 5         |
| Ошибки                    | 0         |
| RPS                       | 0.75      |
| Средняя латентность       | 115.00 ms |
| Медианная латентность     | 84.00 ms  |
| p95 латентность           | 250 ms    |
| p99 латентность           | 250 ms    |
| Max латентность           | 245.00 ms |

### Топ запросов по количеству

| Метод               | Запросов | Avg (ms) | p95 (ms) |
| ------------------- | -------- | -------- | -------- |
| GET /api/terms      | 3        | 135      | 250      |
| GET /api/terms/{id} | 2        | 85       | 86       |

### Sanity — gRPC

| Метрика                   | Значение  |
| ------------------------- | --------- |
| Общее количество запросов | 5         |
| Ошибки                    | 0         |
| RPS                       | 0.61      |
| Средняя латентность       | 109.00 ms |
| Медианная латентность     | 78.00 ms  |
| p95 латентность           | 240 ms    |
| p99 латентность           | 240 ms    |
| Max латентность           | 236.00 ms |

### Топ запросов по количеству

| Метод         | Запросов | Avg (ms) | p95 (ms) |
| ------------- | -------- | -------- | -------- |
| gRPC GetTerms | 5        | 109      | 240      |

Анализ sanity check показал корректность работы обоих сервисов, что позволяет перейти к тестам

## Сценарий: Normal

### Normal — REST

| Метрика                   | Значение   |
| ------------------------- | ---------- |
| Общее количество запросов | 2545       |
| Ошибки                    | 0          |
| RPS                       | 42.59      |
| Средняя латентность       | 116.00 ms  |
| Медианная латентность     | 83.00 ms   |
| p95 латентность           | 340 ms     |
| p99 латентность           | 750 ms     |
| Max латентность           | 1176.00 ms |

### Топ запросов по количеству

| Метод               | Запросов | Avg (ms) | p95 (ms) |
| ------------------- | -------- | -------- | -------- |
| GET /api/terms      | 1886     | 115      | 350      |
| GET /api/terms/{id} | 659      | 117      | 320      |

### Normal — gRPC

| Метрика                   | Значение  |
| ------------------------- | --------- |
| Общее количество запросов | 2660      |
| Ошибки                    | 0         |
| RPS                       | 45.19     |
| Средняя латентность       | 84.00 ms  |
| Медианная латентность     | 81.00 ms  |
| p95 латентность           | 91 ms     |
| p99 латентность           | 140 ms    |
| Max латентность           | 701.00 ms |

### Топ запросов по количеству

| Метод         | Запросов | Avg (ms) | p95 (ms) |
| ------------- | -------- | -------- | -------- |
| gRPC GetTerms | 1997     | 84       | 91       |
| gRPC GetTerm  | 663      | 83       | 91       |

### Сравнение REST vs gRPC (Normal)

| Метрика              | REST  | gRPC  | Разница |
| -------------------- | ----- | ----- | ------- |
| RPS                  | 42.59 | 45.19 | +6.1%   |
| Avg латентность (ms) | 116   | 84    | -27.6%  |
| p95 латентность (ms) | 340   | 91    | -73.2%  |
| Ошибки               | 0     | 0     | —       |

Выводы: 
gRPC обрабатывает на 6.1% больше запросов.
gRPC быстрее на 27.6% по средней латентности и значительно лучше по p95 (73.2%).

## Сценарий: Stress

### Stress — REST

| Метрика                   | Значение   |
| ------------------------- | ---------- |
| Общее количество запросов | 10520      |
| Ошибки                    | 0          |
| RPS                       | 178.14     |
| Средняя латентность       | 278.00 ms  |
| Медианная латентность     | 210.00 ms  |
| p95 латентность           | 670 ms     |
| p99 латентность           | 1300 ms    |
| Max латентность           | 2266.00 ms |

### Stress — gRPC

| Метрика                   | Значение   |
| ------------------------- | ---------- |
| Общее количество запросов | 5500       |
| Ошибки                    | 0          |
| RPS                       | 91.94      |
| Средняя латентность       | 1439.00 ms |
| Медианная латентность     | 1500.00 ms |
| p95 латентность           | 2900 ms    |
| p99 латентность           | 3600 ms    |
| Max латентность           | 4959.00 ms |

### Сравнение REST vs gRPC (Stress)

Выводы: 
REST обрабатывает на 93.8% больше запросов.
gRPC значительно деградирует по латентности при стрессовой нагрузке
Возможная причина деградации - настройки gRPC-сервера (по логам сервера, нагрузка на CPU, RAM, диск и сеть была далека от пиковой), а показательь max_workers в настройках сервера составлял 10

## Сценарий: Stability

### Stability — REST

| Метрика                   | Значение   |
| ------------------------- | ---------- |
| Общее количество запросов | 14919      |
| Ошибки                    | 0          |
| RPS                       | 82.97      |
| Средняя латентность       | 140.00 ms  |
| Медианная латентность     | 110.00 ms  |
| p95 латентность           | 330 ms     |
| p99 латентность           | 560 ms     |
| Max латентность           | 1336.00 ms |

### Топ запросов по количеству

| Метод               | Запросов | Avg (ms) | p95 (ms) |
| ------------------- | -------- | -------- | -------- |
| GET /api/terms      | 11181    | 142      | 340      |
| GET /api/terms/{id} | 3738     | 133      | 300      |

### Stability — gRPC

| Метрика                   | Значение   |
| ------------------------- | ---------- |
| Общее количество запросов | 10421      |
| Ошибки                    | 0          |
| RPS                       | 57.96      |
| Средняя латентность       | 630.00 ms  |
| Медианная латентность     | 550.00 ms  |
| p95 латентность           | 1400 ms    |
| p99 латентность           | 1800 ms    |
| Max латентность           | 2453.00 ms |

### Топ запросов по количеству

| Метод         | Запросов | Avg (ms) | p95 (ms) |
| ------------- | -------- | -------- | -------- |
| gRPC GetTerms | 7808     | 639      | 1400     |
| gRPC GetTerm  | 2613     | 605      | 1300     |

### Сравнение REST vs gRPC (Stability)

| Метрика              | REST  | gRPC  | Разница |
| -------------------- | ----- | ----- | ------- |
| RPS                  | 82.97 | 57.96 | -30.1%  |
| Avg латентность (ms) | 140   | 630   | +350.0% |
| p95 латентность (ms) | 330   | 1400  | +324.2% |
| Ошибки               | 0     | 0     | —       |

Выводы: 
REST обрабатывает на 43.1% больше запросов.
gRPC демонстрирует существенное падение RPS (-30.1%) и увеличение средней латентности на 350%.
В условиях длительной нагрузки REST показывает более стабильное поведение.
Вероятная причина кроется также в настройках gRPC сервера, при max_workers = 10 создается очередь из запросов, которая накапливается с течением времени

## Итоговое сравнение по всем сценариям

### Сводная таблица метрик

| Сценарий  | Протокол | RPS    | Avg (ms) | p95 (ms) | Ошибки |
| --------- | -------- | ------ | -------- | -------- | ------ |
| Sanity    | REST     | 0.75   | 115      | 250      | 0      |
| Sanity    | gRPC     | 0.61   | 109      | 240      | 0      |
| Normal    | REST     | 42.59  | 116      | 340      | 0      |
| Normal    | gRPC     | 45.19  | 84       | 91       | 0      |
| Stress    | REST     | 178.14 | 278      | 670      | 0      |
| Stress    | gRPC     | 91.94  | 1439     | 2900     | 0      |
| Stability | REST     | 82.97  | 140      | 330      | 0      |
| Stability | gRPC     | 57.96  | 630      | 1400     | 0      |

## Общий анализ

При нормальной нагрузке gRPC демонстрирует более высокую эффективность и меньшую латентность.
Однако при стрессовом и длительном тестировании gRPC существенно деградирует по производительности и времени отклика по сравнению с REST, что может указывать на необходимость дополнительной настройки пула соединений или конфигурации gRPC-сервера.




